<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>Vendor Expense Settings</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link href="https://unpkg.com/tippy.js@6/dist/tippy.css" rel="stylesheet"/>
    <link href="https://unpkg.com/tippy.js@6/themes/light.css" rel="stylesheet"/>
    <link href="https://unpkg.com/tippy.js@6/animations/scale.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <style>
        /* Success message animation */
        .success-message {
            animation: slideInDown 0.5s ease-out;
        }
        
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="min-h-screen bg-sky-50">
    <!-- Include header -->
    <div id="header-container" class="w-full"></div>
    <!-- Include navigation -->
    <div id="nav-container" class="w-full"></div>

    <!-- Success Message -->
    <div id="successMessage" class="hidden fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 success-message">
        <div class="flex items-center">
            <i class="fas fa-check-circle mr-2"></i>
            <span>Expense settings saved successfully!</span>
        </div>
    </div>

    <div class="max-w-md mx-auto">
        <!-- Back Navigation -->
        <div class="px-4 py-2">
            <a href="../accounts/vendor-details.html" class="flex items-center text-gray-700">
                <i class="fas fa-chevron-left mr-1"></i>
                <span>Back to Vendor Details</span>
            </a>
        </div>

        <!-- Main Content Card -->
        <div class="bg-sky-400 rounded-t-2xl px-4">
            <div class="text-white py-2">Expense Settings</div>
            
            <!-- Profile Section -->
            <div class="flex justify-center -mb-12">
                <div class="bg-white rounded-full border-4 border-sky-400 w-24 h-24 flex items-center justify-center">
                    <i class="fas fa-user text-5xl text-sky-400"></i>
                </div>
            </div>
        </div>

        <div class="bg-white px-4 pt-16 pb-4 rounded-b-2xl">
            <!-- Vendor Name -->
            <div class="text-center mb-4">
                <h2 class="text-2xl font-bold" id="vendorName">Vendor Name</h2>
            </div>

            <!-- Form -->
            <form id="expenseSettingsForm" class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm mb-1">Department</label>
                        <div class="bg-sky-50 p-2 rounded">
                            <input type="text" id="department" class="w-full bg-transparent outline-none" placeholder="Enter department" />
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm mb-1">Category</label>
                        <div class="bg-sky-50 p-2 rounded">
                            <input type="text" id="category" class="w-full bg-transparent outline-none" placeholder="Enter category" />
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm mb-1">Payment Type</label>
                        <div class="bg-sky-50 p-2 rounded">
                            <select id="paymentType" class="w-full bg-transparent outline-none">
                                <option value="">Select payment type</option>
                                <option value="Net 30">Net 30</option>
                                <option value="Net 60">Net 60</option>
                                <option value="Net 90">Net 90</option>
                                <option value="Cash">Cash</option>
                                <option value="Credit Card">Credit Card</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm mb-1">Since</label>
                        <div class="bg-sky-50 p-2 rounded">
                            <input type="date" id="since" class="w-full bg-transparent outline-none" />
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm mb-1">Communication Preferences</label>
                    <div class="bg-gray-100 p-2 rounded">
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="commPhone" class="mr-2" />
                                <span class="text-sm">Phone Call</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="commText" class="mr-2" />
                                <span class="text-sm">Text Message</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="commEmail" class="mr-2" />
                                <span class="text-sm">Email</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm mb-1">This Vendor is Tax Exempt?</label>
                        <div class="bg-gray-100 p-2 rounded">
                            <select id="taxExempt" class="w-full bg-transparent outline-none">
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm mb-1">Vendor Tax Percentage (%)</label>
                        <div class="bg-sky-50 p-2 rounded">
                            <input type="number" id="taxPercentage" class="w-full bg-transparent outline-none" placeholder="0.00" min="0" max="100" step="0.01" />
                        </div>
                    </div>
                </div>

                <!-- Save Button -->
                <div class="flex justify-end mt-4">
                    <button type="submit" class="bg-sky-400 text-white px-6 py-2 rounded text-sm font-medium hover:bg-sky-500 transition-colors">
                        <i class="fas fa-save mr-2"></i> Save Settings
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Load header and navigation
        fetch('../nav/header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
            });
        fetch('../nav/navigation.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('nav-container').innerHTML = data;
            });

        // Load vendor data from localStorage
        function loadVendorData() {
            const vendorData = localStorage.getItem('selectedVendor');
            if (vendorData) {
                const vendor = JSON.parse(vendorData);
                
                // Update vendor name
                document.getElementById('vendorName').textContent = vendor.vendorName || 'Vendor Name';
                
                // Load expense settings if they exist
                if (vendor.expenseSettings) {
                    document.getElementById('department').value = vendor.expenseSettings.department || '';
                    document.getElementById('category').value = vendor.expenseSettings.category || '';
                    document.getElementById('paymentType').value = vendor.expenseSettings.paymentType || '';
                    document.getElementById('since').value = vendor.expenseSettings.since || '';
                    document.getElementById('taxExempt').value = vendor.expenseSettings.taxExempt || '';
                    document.getElementById('taxPercentage').value = vendor.expenseSettings.taxPercentage || '';
                    
                    // Set communication preferences
                    if (vendor.expenseSettings.communicationPreferences) {
                        document.getElementById('commPhone').checked = vendor.expenseSettings.communicationPreferences.phone || false;
                        document.getElementById('commText').checked = vendor.expenseSettings.communicationPreferences.text || false;
                        document.getElementById('commEmail').checked = vendor.expenseSettings.communicationPreferences.email || false;
                    }
                }
            }
        }

        // Save expense settings
        function saveExpenseSettings(formData) {
            const vendorData = localStorage.getItem('selectedVendor');
            let vendor = vendorData ? JSON.parse(vendorData) : {};
            
            // Create or update expense settings
            vendor.expenseSettings = {
                department: formData.department,
                category: formData.category,
                paymentType: formData.paymentType,
                since: formData.since,
                taxExempt: formData.taxExempt,
                taxPercentage: formData.taxPercentage,
                communicationPreferences: {
                    phone: formData.commPhone,
                    text: formData.commText,
                    email: formData.commEmail
                }
            };
            
            // Save back to localStorage
            localStorage.setItem('selectedVendor', JSON.stringify(vendor));
            
            // Show success message
            showSuccessMessage();
        }

        // Show success message
        function showSuccessMessage() {
            const successMessage = document.getElementById('successMessage');
            successMessage.classList.remove('hidden');
            
            // Hide after 3 seconds
            setTimeout(() => {
                successMessage.classList.add('hidden');
            }, 3000);
        }

        // Handle form submission
        document.getElementById('expenseSettingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                department: document.getElementById('department').value,
                category: document.getElementById('category').value,
                paymentType: document.getElementById('paymentType').value,
                since: document.getElementById('since').value,
                taxExempt: document.getElementById('taxExempt').value,
                taxPercentage: document.getElementById('taxPercentage').value,
                commPhone: document.getElementById('commPhone').checked,
                commText: document.getElementById('commText').checked,
                commEmail: document.getElementById('commEmail').checked
            };
            
            saveExpenseSettings(formData);
        });

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadVendorData();
        });
    </script>
</body>
</html> 